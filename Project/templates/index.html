<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–∏—Å–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤</title>
    <link rel="stylesheet" href="/static/lightTheme.css" id="themeStyle">
</head>
<body>
    <div>

        <header>
            <button id="changeTheme" onclick="changeTheme()">üåó</button>
        </header>

        <div class="kotpovar">
            <img src="static/images/burger.png" alt="–ö–æ—Ç–µ–Ω–æ–∫-–ø–æ–≤–∞—Ä–µ–Ω–æ–∫" width="550" height="550">
        </div>

        <h1>–ü–æ–∏—Å–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –ø–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º</h1>

        <div class="input-section">
            <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ –¥–ª—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞ -->
            <input type="text" id="ingredientInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç" onkeypress="handleEnter(event)">

            <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞ -->
            <button id="addButton" onclick="addIngredient()">+</button>

            <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ -->
            <button id="refreshButton" onclick="window.location.reload();">–°–±—Ä–æ—Å</button>
        </div>

        <!-- –ú–µ—Å—Ç–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞) -->
        <p id="statusMessage"></p>

        <!-- –°–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ -->
        <ul id="ingredientList"></ul>

        <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–≤–æ–¥–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ -->
        <button id="doneButton" onclick="finishInput()">–ì–æ—Ç–æ–≤–æ</button>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ -->
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h2>

        <!-- –ú–µ—Å—Ç–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ -->
        <div id="recipeResults"></div>
    </div>

    <script>
        let ingredients = new Set();

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞
        function addIngredient() {
            const inputField = document.getElementById("ingredientInput");
            const ingredient = inputField.value.trim().toLowerCase(); // –ü–æ–ª—É—á–∞–µ–º –≤–≤–µ–¥–µ–Ω–Ω—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç

            if (!ingredient) return;

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞ –≤ —Ä–µ—Ü–µ–ø—Ç–∞—Ö
            fetch("/check-ingredient", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ ingredient: ingredient })
            })
            .then(response => response.json()) // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
            .then(data => {
                const messageBox = document.getElementById("statusMessage");

                // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–ª–∞—Å—Å—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è
                messageBox.classList.remove("success-message", "error-message");

                if (data.status === "found") {
                    // –ï—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç –Ω–∞–π–¥–µ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ —Å–ø–∏—Å–æ–∫
                    ingredients.add(capitalize(data.ingredient));
                    updateIngredientList(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
                    messageBox.classList.add("success-message"); // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —É—Å–ø–µ—Ö–∞
                    messageBox.textContent = ""
                } else {
                    // –ï—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                    messageBox.textContent = "–¢–∞–∫–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –Ω–µ—Ç –≤ —Ä–µ—Ü–µ–ø—Ç–∞—Ö";
                    messageBox.classList.add("error-message"); // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –æ—à–∏–±–∫–∏
                }

                inputField.value = ""; // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è –≤–≤–æ–¥–∞
                inputField.focus(); // –°—Ç–∞–≤–∏–º —Ñ–æ–∫—É—Å –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
        function updateIngredientList() {
            const ingredientList = document.getElementById("ingredientList");
            ingredientList.innerHTML = ""; // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
            ingredients.forEach(ingredient => {
                const li = document.createElement("li"); // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞
                li.textContent = ingredient; // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç (–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç)
                ingredientList.appendChild(li); // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–≤–æ–¥–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –∏ –ø–æ–∏—Å–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤
        function finishInput() {
            if (ingredients.size === 0) {
                const messageBox = document.getElementById("statusMessage");
                messageBox.textContent = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–æ–¥—É–∫—Ç –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º.";
                messageBox.style.color = "red";
                return;
            }



            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –ø–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º
            fetch("/get-recipes", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ ingredients: Array.from(ingredients) })
            })
            .then(response => response.json()) // –û–±—Ä–∞–±–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
            .then(data => {
                const recipeResults = document.getElementById("recipeResults");
                recipeResults.innerHTML = ""; // –û—á–∏—â–∞–µ–º –æ–±–ª–∞—Å—Ç—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –ø–æ–∏—Å–∫–∞

                if (data.length === 0) {
                    recipeResults.innerHTML = "<p>–†–µ—Ü–µ–ø—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>";
                } else {
                    data.forEach(recipe => {
                        const card = document.createElement("div"); // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —Ä–µ—Ü–µ–ø—Ç–∞
                        card.className = "recipe-card";
                        card.innerHTML = `
                            <h3><a href="${recipe.url}" target="_blank">${recipe.name}</a></h3>
                            <p><strong>–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ:</strong> ${recipe.match_info}</p>
                            <p><strong>–ö–∞–ª–æ—Ä–∏–∏:</strong> ${recipe.calories}</p>
                            <p><strong>–ë–µ–ª–∫–∏:</strong> ${recipe.proteins}</p>
                            <p><strong>–ñ–∏—Ä—ã:</strong> ${recipe.fats}</p>
                            <p><strong>–£–≥–ª–µ–≤–æ–¥—ã:</strong> ${recipe.carbs}</p>
                            <p><strong>–ö–∞–ª–æ—Ä–∏–π –Ω–∞ 100 –≥:</strong> ${recipe.calories100g}</p>
                        `;
                        recipeResults.appendChild(card); // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –≤ –æ–±–ª–∞—Å—Ç—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
                    });
                }


            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–≤–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ —Å—Ç—Ä–æ–∫–∏
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à–∏ Enter
        function handleEnter(event) {
            if (event.key === "Enter") {
                addIngredient();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–º–µ–Ω—ã —Ç–µ–º—ã
        function changeTheme() {
            const lightTheme = "/static/lightTheme.css";
            const darkTheme = "/static/darkTheme.css";
            const link = document.getElementById('themeStyle');
            const currentTheme = link.getAttribute("href");
            link.setAttribute("href", currentTheme === lightTheme ? darkTheme : lightTheme);
        }
    </script>
</body>
</html>
